# Ralph Progress Log
Started: Sun Jan 11 02:28:40 +08 2026
---

## Sun Jan 11 2026 - US-001
Thread: https://ampcode.com/threads/T-019ba92a-f5be-70cc-a827-74679e8f64c9
- Added `vscode-code-notes.aiTool` setting with enum: 'claude', 'opencode', 'custom' (default: 'claude')
- Added `vscode-code-notes.aiToolCommand` setting for custom command path (string, default: '')
- Ran `pnpm run update` to regenerate meta.ts
- Typecheck and lint pass
- Files changed: package.json, src/generated/meta.ts
- **Learnings for future iterations:**
  - Use `pnpm run update` after modifying package.json contributes.configuration to regenerate meta.ts
  - vscode-ext-gen auto-generates typed settings access in meta.ts
---

## Sun Jan 11 2026 - US-002
Thread: https://ampcode.com/threads/T-019ba92c-780d-762d-ae0a-60ee9c1de733
- Added `vscode-code-notes.promptTemplates` setting as object with default 'review' template
- Template supports `{{comments}}` and `{{files}}` placeholders for variable substitution
- Used `additionalProperties` schema to allow arbitrary named templates
- Ran `pnpm run update` to regenerate meta.ts
- Typecheck and lint pass
- Files changed: package.json, src/generated/meta.ts
- **Learnings for future iterations:**
  - Use `additionalProperties` in JSON schema when defining object settings with arbitrary keys
  - Default values for object settings are validated against the schema automatically
---

## Sun Jan 11 2026 - US-003
Thread: https://ampcode.com/threads/T-019ba92e-8145-7132-a52b-0de509c32dbf
- Created src/aiReview.ts with formatCommentsForAI(comments: Comment[]) function
- Function groups comments by file path and formats each as: [category] file:startLine-endLine - text
- Returns object with { formattedComments: string, files: string[] }
- Typecheck and lint pass
- Files changed: src/aiReview.ts
- **Learnings for future iterations:**
  - The Comment type is defined in src/types.ts with filePath, startLine, endLine, text, category fields
  - When formatting line ranges, use single line number if startLine === endLine
---

## Sun Jan 11 2026 - US-004
Thread: https://ampcode.com/threads/T-019ba92f-efc0-73ce-8bb9-b11b0fca2494
- Added buildAICommand(tool, customCommand, prompt) function to src/aiReview.ts
- Handles 'claude', 'opencode', and 'custom' tool types
- Escapes double quotes in prompts to prevent command injection
- Claude uses: `claude -p --permission-mode plan "prompt"`
- OpenCode uses: `opencode run --agent plan "prompt"`
- Custom appends quoted prompt to custom command
- Typecheck and lint pass
- Files changed: src/aiReview.ts
- **Learnings for future iterations:**
  - Double quotes in prompts must be escaped for shell commands
  - Use switch statement with default fallback for tool selection
---

## Sun Jan 11 2026 - US-005
Thread: https://ampcode.com/threads/T-019ba931-78b4-77ae-8637-ee371abf7369
- Implemented sendToAI command in src/commands.ts
- Reads aiTool, aiToolCommand, and promptTemplates from config using configs from meta.ts
- Gets all comments from storage, shows error if none exist
- Formats comments using formatCommentsForAI from aiReview.ts
- Applies default 'review' template with {{comments}} and {{files}} placeholders replaced
- Creates terminal with window.createTerminal('AI Review')
- Sends command to terminal with terminal.sendText() and shows with terminal.show()
- Registered command as codeReview.sendToAI
- Typecheck and lint pass
- Files changed: src/commands.ts
- **Learnings for future iterations:**
  - Use workspace.getConfiguration().get() with configs.X.key and configs.X.default for type-safe config access
  - Terminal commands can be executed via window.createTerminal() and terminal.sendText()
---
